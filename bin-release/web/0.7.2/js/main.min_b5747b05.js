var __reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(e,t,i,a){return new(i||(i=Promise))(function(r,s){function n(e){try{h(a.next(e))}catch(t){s(t)}}function o(e){try{h(a["throw"](e))}catch(t){s(t)}}function h(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(n,o)}h((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function i(e){return function(t){return a([e,t])}}function a(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,s&&(n=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(s,i[1])).done)return n;switch(s=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,s=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(n=h.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){h.label=i[1];break}if(6===i[0]&&h.label<n[1]){h.label=n[1],n=i;break}if(n&&h.label<n[2]){h.label=n[2],h.ops.push(i);break}n[2]&&h.ops.pop(),h.trys.pop();continue}i=t.call(e,h)}catch(a){i=[6,a],s=0}finally{r=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,s,n,o,h={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},AssetAdapter=function(){function e(){}return e.prototype.getAsset=function(e,t,i){function a(a){t.call(i,a,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?a(r):RES.getResAsync(e,a,this)}else RES.getResByUrl(e,a,this,RES.ResourceItem.TYPE_IMAGE)},e}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.score=0,t.blackType=1,t.blackBodys=[],t.blackDis=[],t.blackShape=[],t.blackCache=[],t.blacknumber=0,t.gamed=!1,t}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return e=i.sent(),this.startAnimation(e),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return t=i.sent(),console.log(t),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return i.sent(),this.stage.removeChild(e),[3,5];case 4:return t=i.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,i){var a=new eui.Theme("resource/default.thm.json",e.stage);a.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t.prototype.createGameScene=function(){var e=this,t=new egret.Shape;t.graphics.beginFill(255),t.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),t.graphics.endFill(),t.alpha=1,this.addChild(t);var i=new eui.Label;i.text="游戏规则:点击下方半圆区域，射出黑球阻止白球落下，一共五个黑球，每次撞击白球+1分，接金币+10分,小球模式是双倍积分和球数，但是速度也是双倍哦，本版小球切回大球模式有数量bug",i.textColor=16711680,i.width=this.stage.stageWidth,i.y=200,i.size=40,this.addChild(i);var a=new eui.Button;this.addChild(a),a.label="大球模式",a.width=250,a.height=100,a.x=this.stage.stageWidth/2-50,a.y=this.stage.stageHeight/2-100;var r=new eui.Button;this.addChild(r),r.label="小球模式",r.width=250,r.height=100,r.x=this.stage.stageWidth/2-50,r.y=this.stage.stageHeight/2+100;var s=a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.blackType=1,a.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,s,e),e.removeChild(a),e.removeChild(r),e.removeChild(i),e.removeChild(t),e.gamed?e.restart():e.gameStart()},this),n=r.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.blackType=2,r.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,n,e),e.removeChild(r),e.removeChild(a),e.removeChild(i),e.removeChild(t),e.gamed?e.restart():e.gameStart()},this)},t.prototype.gameStart=function(){function e(t){s.step(t/1e3),c.x=E.position[0]*i,c.y=E.position[1]*i,d.x=g.position[0]*i,d.y=g.position[1]*i;for(var r=0;r<this.blackBodys.length;r++)this.blackBodys[r].displays[0].x=this.blackBodys[r].position[0]*i,this.blackBodys[r].displays[0].y=this.blackBodys[r].position[1]*i,this.blackBodys[r].position[1]>(a+500)/i&&-1===this.blackCache.indexOf(this.blackBodys[r])&&this.blackCache.push(this.blackBodys[r]),l.text="仓库剩余球"+this.blackCache.length;E.position[1]>a/i&&(h.text="你输了",egret.Ticker.getInstance().unregister(e,this),this.gameover())}var t=this,i=50,a=this.stage.stageHeight,r=this.stage.stageWidth,s=new p2.World({gravity:[0,8]});this.world=s;var n=new egret.Shape;n.graphics.beginFill(255),n.graphics.drawRect(0,0,r,a),n.graphics.endFill(),n.alpha=.2,this.addChild(n);var o;o=this.score;var h=new egret.TextField;h.text="总分："+o,h.alpha=.7,h.textColor=16777215,this.addChild(h);var l=new egret.TextField;l.text="0",l.alpha=.7,l.textColor=16777215,l.y=50,this.addChild(l);var c=new egret.Shape;c.graphics.beginFill(16777215),c.graphics.drawCircle(50,50,50),c.graphics.endFill(),this.addChild(c),c.anchorOffsetX=50,c.anchorOffsetY=50,c.x=0,c.y=0;var d=new egret.Shape;d.graphics.beginFill(16776960),d.graphics.drawCircle(20,20,20),d.graphics.endFill(),this.addChild(d),d.anchorOffsetX=20,d.anchorOffsetX=20,d.x=r/2,d.y=50;var p=new p2.Circle({radius:20/i}),g=new p2.Body({mass:.5,position:[r/2/i,50/i]});g.addShape(p),g.displays=[d],g.id=5,s.addBody(g),s.on("endContact",function(e){(e.bodyA.id>20&&5==e.bodyB.id||5==e.bodyA.id&&e.bodyB.id>20)&&(g.position[1]=(t.stage.stageHeight+100)/i,g.velocity=[-1,6],t.score+=10*t.blackType)});var u=new egret.Timer(5e3,0);u.addEventListener(egret.TimerEvent.TIMER,function(){g.position[1]>t.stage.stageHeight/i&&(g.position[1]=50/i,g.velocity=[1,6])},this),u.start();var y=new egret.Shape;y.graphics.lineStyle(10,16777215),y.graphics.drawArc(r/2,a,r/2,Math.PI,0),y.graphics.endFill(),this.addChild(y);var f=new egret.Shape;f.graphics.lineStyle(5,0),f.graphics.drawRect(0,0,r,a),f.graphics.endFill(),this.addChild(f);var v=new p2.Body({mass:1,type:p2.Body.STATIC,position:[r/2/i,0/i]}),m=new p2.Plane;v.addShape(m),v.displays=[];var w=new p2.Body({mass:1,type:p2.Body.STATIC,position:[0/i,a/2/i]}),b=new p2.Plane;w.angle=-Math.PI/2,w.addShape(b),w.displays=[];var _=new p2.Body({mass:1,type:p2.Body.STATIC,position:[r/i,a/2/i]}),C=new p2.Plane;_.angle=Math.PI/2,_.addShape(C),_.displays=[];var E=new p2.Body({mass:1,position:[50/i,50/i]}),T=new p2.Circle({radius:50/i});E.addShape(T),E.displays=[c],E.id=10,this.whiteBody=E;var S=new p2.Material(1);this.materiaA=S;var k=new p2.Material(2);this.materiaB=k;var B=new p2.Material(3);m.material=B,b.material=B,C.material=B,T.material=S;var R=new p2.ContactMaterial(S,k);R.restitution=.8,s.addContactMaterial(R);var x=new p2.ContactMaterial(S,B);x.restitution=.8,s.addContactMaterial(x);var I=new p2.ContactMaterial(k,B);I.restitution=.8,s.addContactMaterial(I),s.addBody(E),s.addBody(v),s.addBody(w),s.addBody(_);var A=RES.getRes("touch_mp3");this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var i=Math.pow(r/2-e.stageX,2),s=Math.pow(a-e.stageY,2),n=Math.pow(r/2,2),o=Math.sqrt(i+s),h=(r/2-e.stageX)/o*20,l=(a-e.stageY)/o*20;n>i+s&&(t.createBlackball(-h,-l),A.play(0,1))},this),s.on("endContact",function(e){10==e.bodyA.id&&e.bodyB.id>20&&(t.score+=t.blackType,h.text="总分："+t.score)}),egret.Ticker.getInstance().register(e,this),this.onticker=e},t.prototype.createBlackball=function(e,t){if(this.blacknumber>=5*this.blackType&&this.blackCache.length>0){var i=new egret.Shape;i.graphics.beginFill(0),i.graphics.drawCircle(0,0,50/this.blackType),i.graphics.endFill(),this.addChild(i);var a=new p2.Circle({radius:50/this.blackType/50});a.material=this.materiaB;var r=this.blackCache.pop();this.removeChild(r.displays[0]),r.displays[0]=i,r.removeShape(r.shapes[0]),r.addShape(a),r.position=[this.stage.stageWidth/2/50,this.stage.stageHeight/50],r.velocity=[e*this.blackType,t*this.blackType]}else{if(!(this.blacknumber<5*this.blackType))return!1;var i=new egret.Shape;i.graphics.beginFill(0),i.graphics.drawCircle(50/this.blackType,50/this.blackType,50/this.blackType),i.graphics.endFill(),this.addChild(i),i.anchorOffsetX=50/this.blackType,i.anchorOffsetY=50/this.blackType,i.x=this.stage.stageWidth/2,i.y=this.stage.stageHeight;var s=new p2.Body({mass:1,position:[this.stage.stageWidth/2/50,this.stage.stageHeight/50]}),a=new p2.Circle({radius:50/this.blackType/50});a.material=this.materiaB,s.id=Math.round(100*Math.random()+20),s.addShape(a),s.displays=[i],s.velocity=[e*this.blackType,t*this.blackType],this.world.addBody(s),this.blackBodys.push(s),this.blackDis.push(i),this.blackShape.push(a),this.blacknumber++}},t.prototype.gameover=function(){var e=this;this.gamed=!0;var t=new egret.Shape;t.graphics.beginFill(16711680),t.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),t.graphics.endFill(),t.alpha=.5,this.addChild(t);var i=new eui.Label;i.text="游戏结束，你的总分是："+this.score,i.textColor=0,i.width=this.stage.stageWidth,i.y=300,i.size=50,this.addChild(i);var a=new eui.Button;this.addChild(a),a.label="重新开始",a.width=250,a.height=100,a.x=this.stage.stageWidth/2-50,a.y=this.stage.stageHeight/2-100;var r=new eui.Button;this.addChild(r),r.label="回到界面",r.width=250,r.height=100,r.x=this.stage.stageWidth/2-50,r.y=this.stage.stageHeight/2+100;var s=a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){r.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,n,e),a.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,s,e),e.removeChild(a),e.removeChild(r),e.removeChild(i),e.removeChild(t),e.restart()},this),n=r.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){a.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,s,e),r.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,n,e),e.removeChild(a),e.removeChild(r),e.removeChild(i),e.removeChild(t),e.createGameScene()},this)},t.prototype.restart=function(){this.whiteBody.velocity=[3,1],this.whiteBody.position=[1,1];for(var e=0,t=this.blackBodys;e<t.length;e++){var i=t[e];i.position[1]<this.stage.stageHeight/50&&(i.position[1]=(this.stage.stageHeight+2e4)/50)}this.score=0,egret.Ticker.getInstance().register(this.onticker,this)},t.prototype.startAnimation=function(e){var t=this,i=new egret.HtmlTextParser,a=e.map(function(e){return i.parse(e)}),r=this.textfield,s=-1,n=function(){s++,s>=a.length&&(s=0);var e=a[s];r.textFlow=e;var i=egret.Tween.get(r);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(n,t)};n()},t}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(e,t,i,a){function r(e){t.call(a,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(a))}var n=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(a,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,i){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(a,generateEUI2)},n)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var o=e.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(a,generateJSON.paths[e])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){t.call(a,generateJSON.paths[e])},n)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(a,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);